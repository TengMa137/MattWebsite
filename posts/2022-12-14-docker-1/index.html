<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <title>
  Steps to set docker environment Â· Welcome
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Matt">
<meta name="description" content="This is a blog post that records the steps to set environment before I successfully trained and run a deep learning model in a docker container. Docker offers an isolated environment for software and dependencies and ensure the application runs quickly and reliably from one computing environment to another, by using container technology. See the difference between docker container and virtual machine in https://www.docker.com/resources/what-container/.
Have docker installed on the host computer, build docker environment following steps below.">
<meta name="keywords" content="blog,developer,personal">



  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Steps to set docker environment">
  <meta name="twitter:description" content="This is a blog post that records the steps to set environment before I successfully trained and run a deep learning model in a docker container. Docker offers an isolated environment for software and dependencies and ensure the application runs quickly and reliably from one computing environment to another, by using container technology. See the difference between docker container and virtual machine in https://www.docker.com/resources/what-container/. Have docker installed on the host computer, build docker environment following steps below.">

<meta property="og:url" content="http://localhost:1313/posts/2022-12-14-docker-1/">
  <meta property="og:site_name" content="Welcome">
  <meta property="og:title" content="Steps to set docker environment">
  <meta property="og:description" content="This is a blog post that records the steps to set environment before I successfully trained and run a deep learning model in a docker container. Docker offers an isolated environment for software and dependencies and ensure the application runs quickly and reliably from one computing environment to another, by using container technology. See the difference between docker container and virtual machine in https://www.docker.com/resources/what-container/. Have docker installed on the host computer, build docker environment following steps below.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2022-12-14T00:00:00+00:00">
    <meta property="article:modified_time" content="2022-12-14T00:00:00+00:00">




<link rel="canonical" href="http://localhost:1313/posts/2022-12-14-docker-1/">



<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.css" media="screen">






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.css" media="screen">
  



 




<link rel="icon" type="image/svg+xml" href="/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">










<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']],
    processEscapes: true,
    processEnvironments: true,
    packages: {'[+]': ['ams', 'noerrors']}
  },
  svg: {
    fontCache: 'global'
  },
  options: {
    renderActions: {
       
      find_script_mathtex: [10, function (doc) {
        for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
          const display = !!node.type.match(/; *mode=display/);
          const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
          const text = document.createTextNode('');
          node.parentNode.replaceChild(text, node);
          math.start = {node: text, delim: '', n: 0};
          math.end = {node: text, delim: '', n: 0};
          doc.math.push(math);
        }
      }, '']
    }
  }
};
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>


</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="http://localhost:1313/">
      Welcome
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/about/">About</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/posts/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/projects/">Projects</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/archive/">Archive</a>
            </li>
          
        
        
          
          
          
            
          
            
              
                <li class="navigation-item menu-separator">
                  <span>|</span>
                </li>
                
              
              <li class="navigation-item">
                <a href="/zh/">ZH</a>
              </li>
            
          
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="http://localhost:1313/posts/2022-12-14-docker-1/">
              Steps to set docker environment
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2022-12-14T00:00:00Z">
                December 14, 2022
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              3-minute read
            </span>
          </div>
          
          
          
        </div>
      </header>

      <div class="post-content">
        
        <p>This is a blog post that records the steps to set environment before I successfully trained and run a deep learning model in a docker container. Docker offers an isolated environment for software and dependencies and ensure the application runs quickly and reliably from one computing environment to another, by using container technology. See the difference between docker container and virtual machine in <a href="https://www.docker.com/resources/what-container/"  class="external-link" target="_blank" rel="noopener">https://www.docker.com/resources/what-container/</a>.
Have docker installed on the host computer, build docker environment following steps below.</p>
<h1 id="create-a-container-and-set-up-environment">
  Create a container and set up environment
  <a class="heading-link" href="#create-a-container-and-set-up-environment">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<p>Open a terminal on host computer and pull a docker image e.g. ubuntu 18.04.</p>
<h2 id="create--enter-a-container">
  Create &amp; enter a container
  <a class="heading-link" href="#create--enter-a-container">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<pre><code class="language-bash">$ docker pull ubuntu:18.04
$ docker images # list all the images
$ docker run -it --shm-size 6G --gpus all --name [container name] -e NVIDIA_DRIVER_CAPABILITIES=compute,utility -e NVIDIA_VISIBLE_DEVICES=all [image id]  # create a container with access to nvidia GPU, refer to https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html #setting-up-nvidia-container-toolkit if unable to locate 
$ docker cp [file path] [container id]:/home  # pass files from the host to container
$ docker exec -it [container id] bash # enter the container
</code></pre>
<h2 id="install-base-utilities">
  Install base utilities
  <a class="heading-link" href="#install-base-utilities">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Now you are in a docker container. Time to install software!</p>
<pre><code class="language-bash">$ apt-get update 
$ apt-get install -y build-essential
$ apt-get install -y wget
$ apt-get clean
</code></pre>
<h2 id="install-miniconda">
  Install miniconda
  <a class="heading-link" href="#install-miniconda">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>In case that you need run projects in different python version, create a conda environment.</p>
<pre><code class="language-bash">$ cd home 
$ mkdir download && cd download
$ wget --quiet https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
$ bash Miniconda3-latest-Linux-x86_64.sh  
$ export PATH=$PATH:/root/anaconda3/bin
</code></pre>
<h2 id="install-cuda">
  Install cuda
  <a class="heading-link" href="#install-cuda">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Install cuda if you use Nvidia card. Choose the right cuda version.</p>
<pre><code class="language-bash">$ cd home/download
$ wget https://developer.download.nvidia.com/compute/cuda/11.3.0/local_installers/cuda_11.3.0_465.19.01_linux.run
$ sh cuda_11.3.0_465.19.01_linux.run # install the dependencies if needed, and choose to install cuda-11.3 only is enough (do not install GPU driver)
</code></pre>
<h2 id="link-libs">
  Link libs
  <a class="heading-link" href="#link-libs">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Export paths to your current environment. Here I use vim to edit ~/.bashrc file, add three lines, save changes and exit vim editor.</p>
<pre><code class="language-bash">$ apt-get install vim 
$ vi ~/.bashrc # add the following 3 lines to .bashrc 
$ export LD_LABRARY_PATH=$LD_LIBRARY_PATH:/usr/local/cuda-11.3/lib64
$ export PATH=$PATH:/usr/local/cuda-11.3/bin
$ export CUDA_HOME=$CUDA_HOME:/usr/local/cuda-11.3
</code></pre>
<p>Don&rsquo;t forget to source ~/.bashrc and the check the cuda installation.</p>
<pre><code class="language-bash">$ source  ~/.bashrc
$ nvcc -V #check the cuda version
</code></pre>
<p>Now you can further set the container according to your project requirements.</p>
<h1 id="trouble-shooting">
  Trouble shooting
  <a class="heading-link" href="#trouble-shooting">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<p>Docker images and containers are saved in /var/lib/docker by default, usually the space is not enough.</p>
<h2 id="one-way-to-change-the-files-location">
  One way to change the files&rsquo; location:
  <a class="heading-link" href="#one-way-to-change-the-files-location">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Check the size of each image and container</p>
<pre><code class="language-bash">$ docker system df -v
</code></pre>
<p>Stop docker service and copy docker files to the new directory (e.g. /home/docker/lib/)</p>
<pre><code class="language-bash">$ systemctl stop docker 
$ rsync -r -avz /var/lib/docker /home/docker/lib/
$ mv /var/lib/docker /var/lib/docker-old
$ ln -s /home/docker/lib/docker /var/lib/
$ systemctl start docker  # check images and containers, delete /var/lib/docker-old if everything is OK
</code></pre>
<h2 id="runtime-error-dataloaders-workers-are-out-of-shared-memory">
  Runtime error: dataloader&rsquo;s workers are out of shared memory.
  <a class="heading-link" href="#runtime-error-dataloaders-workers-are-out-of-shared-memory">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<pre><code class="language-bash">$ df -h | grep shm  # check the shared memory
$ service docker stop
$ cd /var/lib/docker/containers/[container id]
$ vim hostconfig.json # set shm-size to a bigger number
$ service docker start
</code></pre>
<h2 id="not-found-containers">
  Not found containers
  <a class="heading-link" href="#not-found-containers">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<pre><code class="language-bash">$ #try to link the directories again
$ ln -s /home/docker/lib/docker /var/lib/
$ sudo rm -rf /var/lib/docker
</code></pre>
<h1 id="summary">
  Summary
  <a class="heading-link" href="#summary">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<p>This is the basic pipeline to makes things happen in docker container. Find more advanced operations such as dockerfile usage, root permission settings on your own if needed. Things should be easier since you have the initial momentum. Cheers!</p>

      </div>


      <footer>
        


        
        
        
        
        
        
        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    Â©
    
    2025
     Matt 
    Â·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.js"></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>
</html>
